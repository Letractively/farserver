<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>每日统计</title>
<link href="style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/taffy-min.js"></script>


<script type="text/javascript">

var weekday=new Array();
weekday[0]="周日";
weekday[1]="周一";
weekday[2]="周二";
weekday[3]="周三";
weekday[4]="周四";
weekday[5]="周五";
weekday[6]="周六";

var n = weekday[d.getUTCDay()];


$(document).ready(function(){
	var db = new TAFFY();
	db.store("ever365.pomodoro");
	
	var pomodoroByDate = {};
	
	db({type:"todos"}).each(
			function (record,recordnumber) {
				
				if (record.pomodoroes) {
					for(var i=0; i<record.pomodoroes.length; i++) {
						var t = new Date(parseInt(record.pomodoroes[i].split("-")[1]));
						var f = formateDate(t);
						if (pomodoroByDate[f]==null) {
							pomodoroByDate[f] = 1;
						} else {
							pomodoroByDate[f]++;
						}
					}
				}
			}
	);
	
	
	var i = 0;
	var now = new Date().getTime();
	while(i<30) {
		var dd = new Date(now - i*24*60*60*1000);
		var dx = formateDate(dd); 
		
		var cloned = $('#todos').find('li.hidden').clone();
		cloned.removeClass('hidden');
		
		if (dd.getUTCDay()==0 || dd.getUTCDay()==6) {
			cloned.addClass('checked');
		}
		
		cloned.find('div.title-info').html(dx);
		
		
		if (pomodoroByDate[dx]==null) {
		} else {
			cloned.find('span.tomatoes').html(pomodoroByDate[dx]);
		}
		$('#todos').append(cloned);
		i ++;
	}
	
});

function formateTime(date) {
	return (date.getMonth()+1) + "-" + date.getDate() + " " + date.getHours() + ":" + ((date.getMinutes()<10)?("0"+date.getMinutes()):date.getMinutes());
}

function formateDate(date) {
	return (date.getMonth()+1) + "-" + ((date.getDate()<10)?('0'+date.getDate()):date.getDate());
}
</script>

</head>
<body>
	<div id="header-wrapper">
		<div id="header">
			<!--  <a id="lumosity-logo">a</a>-->
			<ul class="header-nav-ul">
				<li><a id="btn-rename" class="header-btn" href="config.html">返回</a></li>
				
			</ul>
		</div>
		
		<div id="message">
		</div>
	</div>

	<div id="content-wrapper">
		<div id="task-list">
				<div class="title">任务列表</div>
				
				<ul id="todos">
					<li class="task hidden" >
						<div class="title-info"></div>
						<div class="icon-info" >
							<span class="tomatoes">0</span>
							<span class="quotes">0</span>
						</div>
						
					</li>
				</ul>
		</div>
	</div>
</body>
</html>