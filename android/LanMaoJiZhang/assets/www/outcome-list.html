<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>支出列表</title>
<script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>
<script type="text/javascript" charset="utf-8" src="zepto.js"></script>
<script type="text/javascript" charset="utf-8" src="money.js"></script>
<script type="text/javascript" charset="utf-8" src="taffy.js"></script>

<link rel="stylesheet" type="text/css" href="style.css"/>

<script type="text/javascript">
var outcomedb = new TAFFY();
outcomedb.store("outcomedb");

$(document).ready(function(){
	outcomedb().order("time_millsecond desc").start(0).limit(10).each(
		function(record,recordnumber) {
			var d = new Date(record.time_millsecond);
			if ($('#month-' + d.getMonth()).length==0) {
				$('ul.simple-list').append('<li id="' + 'month-' + d.getMonth() + '" class="head">' + d.getFullYear() + '年' + (d.getMonth()+1) + '月</li>')
			}
			
			var category = "无分类";
			if (record.items && record.items.length>0) {
				category = record.items[0].category + "等";
			} else {
				if (record.category) {
					category = record.category;
				}
			}
			$('ul.simple-list').append('<li class="detail" id="' + record.___id + '"><div class="dot"><div class="checkbox"></div></div><div class="title">' + record.title + '</div>'
					+ '<div class="infos">分类: ' + category + ', 时间 ' + d.getDate() + '日</div>'
					+ '<div class="big">' + record.total + '</div></li>');
		}
	);
});

function bindEvent(evt) {
	$('#to-main').bind(evt, goToMain);
	$('#btn-new-outcome').bind(evt, addOutCome);
	$('#btn-remove-outcome').bind(evt, removeSelected);
	$('ul.simple-list li.detail div.title').live(evt, editOutCome);
	$('ul.simple-list li.detail div.infos').live(evt, editOutCome);
	$('ul.simple-list li.detail div.checkbox').live(evt, toggleChecked);
}

function editOutCome() {
	location.href = "outcome-edit.html?id=" + $(this).parent().attr("id"); 
}

function toggleChecked() {
	var container = $(this).parent().parent();
	if (container.hasClass("checked")) {
		container.removeClass("checked");
	} else {
		container.addClass("checked");
	}
	
	if ($('li.checked').length>0) {
		$('#li-remove-outcome').show();
	} else {
		$('#li-remove-outcome').hide();
	}
}

function removeSelected() {
	if (confirm("是否确认删除选择的支出记录？")) {
		$('li.checked').each(function() {
			var li = $(this);
			outcomedb(li.attr("id")).remove();
			li.remove();
		});
	}
}

</script>
</head>
<body>

<div id="topmenu">
	<ul class="left">
		<li>
			<span class="button" id="to-main">
				<span class="innerspan">
					<span class="text">主页面</span>
					<span class="ui-icon icon-home"></span>
				</span>
			</span>
		</li>
	</ul>
	
	<ul class="right">
		<li style="display:none" id="li-remove-outcome" >
			<span class="button" id="btn-remove-outcome">
				<span class="innerspan">
					<span class="text">删除</span>
					<span class="ui-icon icon-remove"></span>
				</span>
			</span>
		</li>
		
		<li>
			<span class="button" id="btn-new-outcome">
				<span class="innerspan">
					<span class="text">新建</span>
					<span class="ui-icon icon-add"></span>
				</span>
			</span>
		</li>
	</ul>
</div>


<ul class="simple-list">
	
</ul>

</body>
</html>