<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>chart</title>

<script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>
<script type="text/javascript" charset="utf-8" src="xui-2.3.2.min.js"></script>
<script type="text/javascript" charset="utf-8" src="awesomechart.js"></script>
<script type="text/javascript" charset="utf-8" src="time.js"></script>

<link rel="stylesheet" type="text/css" href="time.css"/>

<script type="text/javascript">
x$(window).load(function(e) {
	var d = getParam('date');
	if (d==0) {
		d = new Date();
	} else {
		d = new Date(d);
	}
	
	var collections = list("me", d);
	var colorSrc = ['#006CFF', '#FF6600', '#34A038', '#945D59', '#93BBF4', '#F493B8'];
	var colors = [];
	for(var i=0; i<collections.length; i++) {
		if (i>colorSrc.length) {
			colors.push(0);
		} else {
			colors.push(colorSrc[i]);
		}
	}
	var data = [];
	var labels = [];
	var total = 0;
	
	for(var i=0; i<collections.length; i++) {
		labels.push("");//collections[i].desc
		var dura = collections[i].dura;
		if (collections[i].laststart!=0) {
			dura = collections[i].dura + new Date().getTime()-collections[i].laststart;
		}
		//o.dura = formatDura(dura);
		data.push(dura);
		total += dura;
	}
    
	for(var i=0; i<collections.length; i++) {
		x$('#container').after('<div style="margin-top:3px; padding-left:5px; font-weight: bold;font-size: 12px;color:' + colors[i] + '; border-left: 20px solid ' + colors[i] + ';">' 
		+ collections[i].desc + "   -   " + Math.floor((data[i]/total)*100) + "%</font>");
	}
	
	x$('#chartCanvas6').attr("width", screen.availWidth-20);
	x$('#chartCanvas6').attr("height", screen.availWidth-20);
	
	var chart6 = new AwesomeChart('chartCanvas6');
	chart6.chartType = "pie";
	chart6.pieTotal = total;
	chart6.title = "当日时间比例";
	chart6.data = data;
	chart6.labels = labels;
	chart6.colors = colors;
	chart6.draw();
    
    /*
	var chart;
   	chart = new Highcharts.Chart({
      chart: {
         renderTo: 'container',
         plotBackgroundColor: null,
         plotBorderWidth: null,
         plotShadow: false
      },
      title: {
         text: 'aaa'
      },
      tooltip: {
         formatter: function() {
            return '<b>'+ this.point.name +'</b>: '+ this.point.dura;
         }
      },
      plotOptions: {
         pie: {
            allowPointSelect: false,
            cursor: 'pointer',
            dataLabels: {
               enabled: true,
               color: '#000000',
               connectorColor:'#000000',
               formatter: function() {
                  return '<b>'+ this.point.name +'</b>: '+ this.point.dura +' %';
               }
            }
         }
      },
       series: [{
         type: 'pie',
         name: 'Browser share',
         data: pieSource
      }]
   });
	*/
});
	

function getParam(name) {
	var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href); 
	if (!results) { return 0; } return results[1] || 0;
}


</script>
</head>
<body>

<div id="topmenu">
	<a class="simple-button" href="index.html">返回主页面</a>
</div>


<div id="container" >
	<canvas id="chartCanvas6" ></canvas>
</div>

<div id="desc">
	
</div>

</body>
</html>