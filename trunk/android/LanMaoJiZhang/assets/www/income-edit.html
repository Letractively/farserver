<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>收入编辑</title>
<script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>
<script type="text/javascript" charset="utf-8" src="zepto.js"></script>
<script type="text/javascript" charset="utf-8" src="money.js"></script>
<script type="text/javascript" charset="utf-8" src="taffy.js"></script>

<link rel="stylesheet" type="text/css" href="style.css"/>

<script type="text/javascript">

var incomedb = new TAFFY();
incomedb.store("incomedb");

var incomeid = null;

$(document).ready(function(){
	
	var d = new Date();
	$('#year').val(d.getFullYear());
	$('#month').val(d.getMonth()+1);
	$('#date').val(d.getDate());
	
	var id = getParam("id");
	if (id!=0) {
		incomeid = id;
		var income = incomedb(id).first();
		$('#total').val(outcome.total);
		$('#desc').val(outcome.title);
		d = new Date(outcome.date);
	}
});


function bindEvent(evt) {
	$('#to-main').bind(evt, goToMain);
	$('#to-income-list').bind(evt, goIncomeList);
	$('#btn-save').bind(evt, saveOrUpdate);
}

function goIncomeList() {
	location.href = "income-list.html";
}
/*
 ___id: "T000074R000007"
___s: true
_id: "4f2276d4e04788f13ac270f0"
created: 1327658708503
creator: "jizhang"
db: "incomedb"
desc: ""
endowmentInsurance: 0
formid: "addInComeForm"
from: "亲戚"
fullSalary: 0
housingReserve: 0
intype: "其他"
jobInsurance: 0
medicalInsurance: 0
personalTax: 0
time: "2012-01-24"
time_millsecond: 1327399517974
title: "得到的压岁钱"
total: 350
updated: 1327658717976
 */

function saveOrUpdate() {
	var income = {};
	
	if ($('#total').val()=="" || parseInt($('#total').val())==Number.NaN || parseInt($('#total').val())<0) {
		alert("收入的数额必须是大于0的数字");
		return;
	}
	income.total = $('#total').val();
	income.title = $('#desc').val();
	income.date = new Date($('#year').val(), parseInt($('#month').val())-1, $('#date').val());
	income.created = new Date().getTime();
	income.desc = "";
	income.from = $('#from').val();
	income.time_millsecond = income.date.getTime();
	
	
	if (incomeid==null) {
		//insert
		incomedb.insert(income);
	} else {
		incomedb(incomeid).update(income);
	}
	
	goIncomeList();
}

</script>
</head>
<body>
<div id="topmenu">
	<ul class="left">
		<li>
			<a  class="button" id="to-main">
				<span class="innerspan">
					<span class="text">主页面</span>
					<span class="ui-icon icon-home"></span>
				</span>
			</a>
		</li>
	</ul>
	
	<ul class="right">
		<li>
			<span  class="button" id="to-income-list">
				<span class="innerspan">
					<span class="text">收入列表</span>
					<span class="ui-icon icon-list"></span>
				</span>
			</span>
		</li>
		<li>
			<span  class="button" id="btn-save">
				<span class="innerspan">
					<span class="text">保存</span>
					<span class="ui-icon icon-save"></span>
				</span>
			</span>
		</li>
	</ul>
</div>

<div class="label">
	金额*  <input id="total" type="number" size="4"> 
</div>
<div class="label">
	描述*  <input type="text" id="desc"  size="10"> 
</div>
<div class="label">
	日期*   <input id="year" type="number" size="4">年<input id="month" type="number" size="2"> 月 <input type="number"  id="date" size="2">日
</div>
<div class="label">
	收入类型: 
	<select name="intype" >
		<option>固定收入</option>
		<option>奖金及补贴</option>
		<option>股票与其他投资</option>
		<option>兼职</option>
		<option>固定资产收益</option>
		<option>其他</option>
	</select>
</div>
<div class="label">
	付款方： <input type="text" id="from" size="10"> 
</div>
<div class="label"> 
	税前工资 <input type="text" name="fullSalary" class="number"><button onclick="calculateTax()">计算</button> <br>
	住房公积金: <input type="text" name="housingReserve" size="5" class="number">
	养老保险: <input type="text" name="endowmentInsurance" size="5" class="number">
	医疗保险: <input type="text" name="medicalInsurance" size="5" class="number">
	失业保险: <input type="text" name="jobInsurance" size="5" class="number">
	缴纳个税:  <input type="text" name="personalTax" size="5" class="number">
</div>

</body>
</html>