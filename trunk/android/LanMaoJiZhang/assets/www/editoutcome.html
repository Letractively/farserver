<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>懒猫记账</title>
<script type="text/javascript" charset="utf-8" src="phonegap-1.3.0.js"></script>
<script type="text/javascript" charset="utf-8" src="xui-2.3.2.min.js"></script>
<script type="text/javascript" charset="utf-8" src="money.js"></script>
<script type="text/javascript" charset="utf-8" src="taffy-min.js"></script>


<link rel="stylesheet" type="text/css" href="style.css"/>

<style type="text/css">

div.hidden {
	display: none;
}

div.multiedit {
	background-color: #ccc;
}

</style>

<script type="text/javascript">


var categories = [];

function loadCategories() {
	var categorydb = new TAFFY();
	categorydb.store("categorydb");
	
	categorydb().each(
		function(r, i) {
			categories.push(r.category);
		}	
	);
}


var outcomedb = new TAFFY();
outcomedb.store("outcomedb");


var outcomeid = null;
x$(window).load(function(e) {
	loadCategories();
	fillselect(x$('#category'));
	fillselect(x$('#subcategory'));
	
	var id = getParam("id");
	if (id!=0) {
		outcomeid = id;
		//edit 
	}
	
	
});

function fillselect(select) {
	for(var i=0; i<categories.length; i++) {
		select.bottom('<option>' + categories[i] + "</option>");
	}
} 


function onOutTypeChange(e) {
	var value = x$('#outtype')[0].value;
	if (value == "single") {
		x$('.multiedit').addClass("hidden");
		x$('div.category').removeClass("hidden");
	} else if (value == "multiple") {
		x$('.multiedit').removeClass("hidden");
		x$('div.category').addClass("hidden");
	} else {
		x$('.multiedit').addClass("hidden");
		x$('div.category').addClass("hidden");
	}
}

function saveOrUpdate() {
	
	if (outcomeid==null) {
		//insert
		var outcome = {};
		outcome.desc = x$('#desc')[0].value;
		outcome.date = new Date(x$('#year')[0].value, parseInt(x$('#month')[0].value)-1, x$('#date')[0].value);
		outcome.total = x$('#total')[0].value;
		outcome.outmethod = x$('#outmethod')[0].value;
		outcome.outtype = x$('#outtype')[0].value;
		outcome.datemill = outcome.date.getTime();
		outcomedb().insert(outcome);
		
	} else {
		
	}
}


</script>
</head>
<body>
<div id="topmenu">
	<ul class="left">
		<li>
			<a  class="button" ontouchend="location.href='index.html'" href="javascript:void(0)">
				<span class="innerspan">
					<span class="text">主页面</span>
					<span class="ui-icon icon-home"></span>
				</span>
			</a>
		</li>
	</ul>
	
	<ul class="right">
		<li>
			<a  class="button" ontouchend="saveOrUpdate()" href="javascript:void(0)">
				<span class="innerspan">
					<span class="text">保存</span>
					<span class="ui-icon icon-save"></span>
				</span>
			</a>
		</li>
	</ul>
</div>
<div class="label">
	支出描述*  <input type="text" id="desc"  size="10"> 
</div>
<div class="label">
	日期   <input id="year" type="number" size="4">年<input id="month" type="number" size="2"> 月 <input type="number"  id="date" size="2">日
</div>

<div class="label">
	金额*  <input type="text" id="total" type="number" size="4"> 
</div>

<div class="label">
	支出方式 * ：  
	<select id="outmethod" >
			<option default="1">现金</option>
			<option>刷卡</option>
			<option>网上支付</option>
	</select> 
</div> 

<div class="label">
	支出类型： 
	<select id="outtype" onchange="onOutTypeChange()">
		<option value="single" >单项支出</option>
		<option value="multiple">多项支出</option>
		<option value="expecial">不计分类支出</option>
	</select>
</div>


<div class="label category">
	所属分类 ： 
	<select id="category" class="category">
	</select> 
</div>


<div class="label multiedit hidden">
	支出项：<input type="text" name="title" size="10">
</div>

<div class="label multiedit hidden">
	金额 :<input type="text" name="cost" size="4"  class="number">
</div>

<div class="label multiedit hidden">
	类别:<select id="subcategory" name="category"></select></label>
</div>
<div class="label multiedit hidden">
	<a href="javascript:void(0)" ontouchend="addSubItem()">增加子项</a>
</div>

<div class="hidden multiedit">
	<ul class="multilist">
	</ul>
</div>


</body>
</html>