<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="js/slidernav/slidernav.css" media="screen, projection" />
<script type="text/javascript" src="js/slidernav/slidernav.js"></script>

</head>

<script type="text/javascript">
var id = getParam("id");
var collections = "sales";

$(document).ready(function(){

	$.getJSON("service/conselect.gs", 
			{},
			function(data) {
				var wul = $('#slider ul');
				for(var i=0; i<data.length; i++) {
					if (data[i].firstLetter) {
						var l = data[i].firstLetter.toLowerCase();
						var group = $('#' + l);
						if (group.length==0) {
							group = $('<li id="' + l + '"><a name="' + l + '" class="title">' + l + '</a><ul></ul></li>');
							wul.append(group);
						}
						group.find('ul').append('<li><a href="javascript:void(0)" id="' + data[i].id + '">' + data[i].name + "(" + data[i].alias + ')</a></li>');
					} 
				}
				$('.slider-content ul ul li a').click(function(){
					$('input[name="consumer"]').val($('input[name="consumer"]').val() + " " + $(this).html());
				});
				$('#slider').sliderNav();
			}
	);

		
	if (id!=null) {
		$.getJSON("service/edit.gs",
				{
					"collection": collections,
					"id": id
				},
				function(data) {
					for(var o in data) {
						$('*[name="' + o + '"]').val(data[o]);
					}
				}
		);
	}
});

function saveObj(create) {
	var req = new Object();
	req.collection = collections;
	if (id!=null) req.id = id;

	$('input,select,textarea').each(
			function() {
				req[$(this).attr("name")] = $(this).val();
			}
	);

	$.post("service/save.gs",
			req,
			function(data) {
				if (create) {
					location.href= location.pathname;
				} else {
					alert("保存完成");
				}
			}
	);
}


function getParam(strname) {
	var hrefstr, pos, parastr, para, tempstr;
	hrefstr = window.location.href;
	pos = hrefstr.indexOf("?")
	parastr = hrefstr.substring(pos + 1);
	para = parastr.split("&");
	tempstr = "";
	for (i = 0; i < para.length; i++)
	{
		tempstr = para[i];
		pos = tempstr.indexOf("=");
		if (tempstr.substring(0, pos) == strname) {
			return tempstr.substring(pos + 1);
		}
	}
	return null;
}



</script>


<body>

<div class="header">
	<div class="container980">
		<a id="logo"></a>
		<ul>
			<li>
				<span id="c_list">&nbsp;</span>
				<a href="consumerlist.html">客户列表</a>
			</li>
			<li>
				<span id="c_actvity">&nbsp;</span>
				<a href="activities.html">客户动态</a>
			</li>
			<li>
				<span id="c_pre">&nbsp;</span>
				<a href="pre-sales.html">售前跟踪</a>
			</li>
			<li>
				<span id="c_center">&nbsp;</span>
				<a href="sales.html">售中管理</a>
			</li>
			<li>
				<span id="c_after">&nbsp;</span>
				<a href="after-sales.html">售后信息</a>
			</li>
			<li>
				<span id="c_ana">&nbsp;</span>
				<a href="analysis.html">分析</a>
			</li>			
		</ul>
		
	</div>
</div>

<div class="mainbody">

	<form action="service/update.gs" method="POST">
	<div class="container980 kform">
		<div class="cats">
			<h3>基本信息</h3>
			
			<div class="bigleft">
				<label >订单名</label> <input name="name"> <br>
				<label >总金额</label> <input name="total"> <br>
				<label >付款方式</label> 
					<select name="paymethod">
						<option value="支票">支票</option>
						<option value="现金">现金</option>
						<option value="邮政汇款">邮政汇款</option>
						<option value="电汇">电汇</option>
						<option value="网上银行">网上银行</option>
						<option value="其他">其他</option>
					</select><br>
				<label >发货日期</label> <input name="senddate"><br>
				<label >收货人地址</label> <input name="location"><br>
				<label >阶段</label> 
					<select name="stage">
						<option value="处理中">处理中</option>
						<option value="完成">完成</option>
						<option value="中止">中止</option>
					</select><br>
				<label >备注</label><br>
			 	<textarea tabindex="4" rows="2" cols="60" name="info"></textarea><br>
			</div>
			
			<div class="smallright" style="padding: 0px" >
				客户
				<input name="consumer"><br>
				<div id="slider" style="padding: 0px">
					<div class="slider-content" style="padding: 0px">
						<ul>
						</ul>
					</div>
					
				</div>
			</div>
			
		</div> 
		
		<div class="cats">
			<div class="columns3">
				<input type="button" value="保存" onclick="saveObj()">
			</div>
			<div class="columns3">
				<input type="button" value="保存并新建" onclick="saveObj(true)">
			</div>
		</div>
	</div>
	</form>
</div>


<div class="footer">

<div id="copyright">
    <span>&copy;2010 <a title="1stwebdesigner &ndash; Graphic and Web Design Blog - 1stwebdesigner is a design blog dedicated to bloggers, freelancers, web-developers and designers. Topics focus on web design and inspirational articles." href="http://www.1stwebdesigner.com">1stwebdesigner &ndash; Graphic and Web Design Blog</a>. Design by <a title="Dainis Graveris on deviantART" href="http://dainix.deviantart.com/">Dainis Graveris</a>. WordPress Theme by <a title="Daniel Kurdoghlian on Twitter" href="http://twitter.com/derblub">Daniel Kurdoghlian</a></span>
</div>

</div>

</body>
</html>